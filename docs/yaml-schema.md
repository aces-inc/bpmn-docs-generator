# 業務プロセス図 YAML スキーマ

YAML で BPMN 風の業務プロセス（スイムレーン・タスク・分岐・フロー）を定義し、編集可能な PPTX に変換するためのスキーマです。

## 概要

- **actors**: スイムレーン（アクター）の名前を並べたリスト。左から右の順でレーンが並ぶ。
- **nodes**: ノードを連番・リストで記述。各ノードは「ID」「タスク／分岐」「どのアクターか」「タスク内容」「接続先（番号）」を持つ。

## ルートキー

| キー | 必須 | 説明 |
|------|------|------|
| `actors` | ✅ | スイムレーン名のリスト。例: `["お客様", "IT営業", "社内"]` |
| `nodes` | ✅ | ノードのリスト。各要素は下記のノード形式 |

## ノード形式

各ノードは次のキーで記述する。

| キー | 必須 | 説明 |
|------|------|------|
| `id` | ✅ | ノードの一意識別子。数値または文字列。接続先の参照に使う。 |
| `type` | ✅ | `task`（タスク）、`gateway`（分岐）、`start`（開始）、`end`（終了）、`artifact`（成果物）、`service`（システム接続用のサービス）。開始・終了は正円、成果物はフローチャートのデータ図形、サービスは磁気ディスク図形で描画される。 |
| `gateway_type` | - | `gateway` のときのみ。`exclusive`（条件分岐・菱形に✕）または `parallel`（並行・菱形に＋）。省略時は `exclusive`。 |
| `actor` | ✅ | このノードが属するスイムレーン。アクター名（文字列）または 0 始まりのインデックス（整数） |
| `label` | ✅ | 表示するテキスト（タスク内容・分岐のラベルなど）。分岐は PPTX 上では ✕/＋ のみ表示。 |
| `next` | ✅ | 接続先ノードの ID のリスト。例: `[2, 3]`。分岐で矢印にラベル（Yes/No 等）を付ける場合は `[{ id: 2, label: "Yes" }, { id: 3, label: "No" }]` のようにオブジェクトで指定する。順序はフロー順。**ループ**: 開始ノードの ID を指定すると、そのタスクから開始ノードへ戻る矢印（ループ）が PPTX 上に描画される。 |
| `request_to` | - | システム接続。このタスクからリクエストを送るサービスノードの ID のリスト。指定すると、人タスクからサービスへ点線（人側○・サービス側矢印）で描画される。 |
| `response_from` | - | システム接続。このタスクがレスポンスを受け取るサービスノードの ID のリスト。指定すると、サービスから人タスクへ下→上の点線で描画される。 |

## 例

```yaml
actors:
  - お客様
  - IT営業
  - 社内
  - 導入・サポート

nodes:
  - id: 1
    type: task
    actor: 0
    label: 要件検討
    next: [2]
  - id: 2
    type: gateway
    actor: 0
    label: 成約?
    next: [3, 4]
  - id: 3
    type: task
    actor: 1
    label: 契約手続き
    next: [5]
  - id: 4
    type: task
    actor: 0
    label: 見送り
    next: []
  - id: 5
    type: task
    actor: 2
    label: 契約審査
    next: [6]
  - id: 6
    type: task
    actor: 3
    label: キックオフ
    next: []
```

## 制約・注意

- `next` で参照する ID は、同じ YAML 内のいずれかのノードの `id` と一致している必要がある。
- `actor` は `actors` のインデックス（0 始まり）か、`actors` に含まれる名前のいずれかで指定する。
- スキーマの厳密な検証は行わず、ベストエフォートで PPTX を生成する。
- **ループ**: タスクの `next` で開始ノードの ID を参照すると、フローが開始に戻るループとして描画される。開始ノードは常に左端（列0）に配置される。
- **成果物**: `type: artifact` のノードは、作成・保存する成果物を表す。PPTX 上ではフローチャートの「データ」図形で描画され、`label` に成果物名を記載する。
- **システム接続**: `type: service` のノードは、システムレーン内のサービスを表し、磁気ディスク図形で描画される。人タスクに `request_to: [サービスID]` を指定するとリクエストの点線（人側○・サービス側矢印）、`response_from: [サービスID]` を指定するとレスポンスの点線（下→上）が描画される。列がずれる場合は L 字（elbow）点線になる。
