---
Created: 2025-02-18
Owner: x4066x
Status: draft
---

# 実装計画: タスクサイズ・レーン縦伸ばし・1スライドあたり列数のパラメータ化

## Goal

1. **タスクサイズ**: アクター（スイムレーン）内のタスクを広く表示できるようにする。サイズ（またはレーンに対する比率）は **layout パラメータで指定可能**にする（未指定時は現状維持。正方形でも長方形でも指定で対応可能とする）。
2. **アクターが少ないとき**: 余白内でレーンを縦に広げて表示する。タスクは指定したサイズ／比率のまま中央配置する。
3. **1スライドあたりの列数**: 現状は幅から自動計算（約8列）だが、9列以上も含めて **YAML の layout でパラメータ指定できるようにする**。
4. **スイムレーン区切り線**: アクターの四角を大きくしても、**スイムレーンの区切りとなる点線はアクター四角の境界（四角と四角の間）に描画される**ようにする。
5. **フォントサイズ**: タスク・アクター名・矢印ラベル等のフォントサイズを **layout パラメータで指定可能**にする。

## Background / Motivation

- タスクが小さく感じるため、大きめに表示したい。サイズは **パラメータで指定可能**にしたい。
- アクター数が少ない図では、縦方向の余白を活かしてレーンを縦に伸ばして見やすくしたい。
- 横に8列入るが、9列まで入るようにしたい／列数を固定したいという要望があり、**列数もレイアウトの設定項目**として扱いたい。
- アクター四角を大きくしたときも、**スイムレーン区切り（点線）はアクター四角の境界（四角と四角の間）**に描かれるようにしたい。
- フォントサイズも **パラメータで変更可能**にし、スライドや用途に合わせて調整できるようにしたい。

## Constraints

- 既存の YAML スキーマ・PPTX レイアウト仕様（余白・システムレーン等）に抵触しない範囲で拡張する。
- 使用言語・ランタイムは既存どおり（Python + uv）。`compute_layout`（yaml_loader）と `yaml_to_pptx`（yaml2pptx）の責務分担は現状のまま拡張する。
- レーン区切り点線の Y 座標は、**レーン境界**（アクター四角の上端／下端の境界）と一致させる。アクター四角が lane_height で描画されている限り、区切り線は「四角と四角の間」に必ず来るように実装する。
- フォント・タスクサイズの下限は、可読性を損なわない範囲で許容する（既定値は現状維持。パラメータで下げた場合の最小値は必要に応じて設ける）。

## Definition of Done

- [ ] **タスクサイズのパラメータ化**: YAML の `layout` でタスクのサイズ（またはレーン高さに対する比率／倍率）を指定できる。未指定時は現状どおり。指定により「少し広く」や「より大きく」が選べる。
- [ ] **アクターが少ないときの縦伸ばし**: アクター数が少ない場合、図の描画領域（content_top_offset ～ 下端余白）内でレーン高さを縦に割り当て、タスクは指定サイズのまま中央配置される。
- [ ] **列数のパラメータ化**: YAML の `layout` に「1スライドあたりの最大列数」を指定するキー（例: `max_cols_per_slide` または `columns_per_slide`）を追加し、指定した列数でレイアウトが計算される（未指定時は現行どおり幅から自動計算）。9列指定で意図どおり並ぶことを検証可能にする。
- [ ] **スイムレーン区切り線**: アクター四角の描画高さ（lane_height）と区切り線の Y 座標が一致しており、区切り線が「アクター四角と四角の間」に描かれる。アクター四角を大きくした場合も同様に正しく境界に描画される。
- [ ] **フォントサイズのパラメータ化**: YAML の `layout` でフォントサイズ（pt）を指定できる。対象は少なくとも「タスク／ノード内テキスト」「アクター名」「矢印ラベル」など。未指定時は現状の 10pt／8pt 等を維持。
- [ ] **docs/yaml-schema.md** および **.cursor/skills/process-yaml/SKILL.md** に、上記レイアウトパラメータ（タスクサイズ・列数・フォントサイズ・区切り線の前提）の書き方と未指定時の挙動を追記する。

## Assumptions

- タスクサイズは layout で「比率」または「倍率」または「絶対値（pt/em 等）」のいずれかで指定可能にする。キー名は DR で決める。
- 列数パラメータは「最大列数」として扱い、指定値でスライド分割する（既に `compute_layout(max_cols_per_slide=...)` の引数は存在するため、YAML から渡す形で拡張する）。
- アクターが少ないときの縦伸ばしは、**利用可能な高さ**をアクター数で割ってレーン高さ（lane_height）を決め、そのレーン内にタスクを配置する。区切り線は lane_height の境界（i * lane_height, i=1..n-1）に描くため、アクター四角も同じ lane_height で描けば区切り線は常に四角の間になる。
- フォントサイズは「全体で1つ」か「タスク用・アクター用・ラベル用で分ける」のいずれかでよい。詳細は実装時に決める。

## Decision Required

| ID | 内容 | 選択肢 | Priority |
|----|------|--------|----------|
| DR-001 | タスクサイズの layout キーと指定方法 | 比率（例: レーン高さに対する 0.6～0.9） / 倍率（例: 1.0, 1.2） / その他。キー名例: `task_size_ratio`, `task_scale` | P1 |
| DR-002 | 列数パラメータの YAML キー名 | `max_cols_per_slide` / `columns_per_slide` / その他（希望があれば記載） | P0 |
| DR-003 | フォントサイズの layout キー | 1キーで全体（例: `font_size_pt`） / 種別ごと（例: `task_font_pt`, `actor_font_pt`, `label_font_pt`） | P1 |

## References

- レイアウト計算: `process_to_pptx/yaml_loader.py`（ProcessLayout, compute_layout, _base_sizes_for_actors, TASK_SIDE_RATIO）
- 描画: `process_to_pptx/yaml2pptx.py`
- 余白・layout: `docs/plans/20250217-margins-and-system-swimlane/plan.md`, `docs/yaml-schema.md`
